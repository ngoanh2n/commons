/**
 * @author Ho Huu Ngoan (ngoanh2n@gmail.com)
 * @since 2021-01-16
 * Allure Gradle Plugin: https://github.com/allure-framework/allure-gradle
 */
buildscript {
    repositories {
        mavenCentral()
        maven { url "https://plugins.gradle.org/m2/" }
    }
    dependencies {}
    apply from: "gradle/versions.gradle"
}

plugins {
    id("java")
    id("idea")
    id("signing")
    id("java-library")
    id("maven-publish")
    id("io.qameta.allure") version "2.11.2"
}

group("com.github.ngoanh2n")
version("2.14.0")
description("Utilities of com.github.ngoanh2n")

apply from: "gradle/testing.gradle"
apply from: "gradle/compilation.gradle"
apply from: "gradle/publishing.gradle"
apply from: "gradle/dependencies.gradle"

repositories {
    mavenCentral()
    maven { url "https://plugins.gradle.org/m2/" }
}

reporting {
    setBaseDir(layout.buildDirectory.dir("reports"))
}

allure {
    version = "$versionAllure"
    adapter {
        aspectjWeaver = true
        aspectjVersion = "1.9.5"
        autoconfigureListeners = true

        frameworks {
            junit5 {
                enabled = true
                autoconfigureListeners = true
            }
        }
    }
    report {
        reportDir = project.reporting.baseDirectory.dir("allure-report")
    }
}

clean.doFirst {
    delete project.file("out")
}

tasks.build.configure {
    dependsOn.removeIf { task -> (task == "check") }
    assemble.dependsOn("clean")
    dependsOn("publishToMavenLocal")
}
